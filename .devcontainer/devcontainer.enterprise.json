{
  "name": "Premium Ecosystem - Enterprise Codespace",

  // Imagen base con Node.js 20 LTS
  "image": "mcr.microsoft.com/devcontainers/typescript-node:20-bullseye",

  // Características adicionales (Features)
  "features": {
    // Git avanzado
    "ghcr.io/devcontainers/features/git:1": {
      "version": "latest",
      "ppa": true
    },

    // GitHub CLI con extensiones
    "ghcr.io/devcontainers/features/github-cli:1": {
      "version": "latest",
      "installDirectlyFromGitHubRelease": true
    },

    // Docker-in-Docker para testing
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "latest",
      "moby": true,
      "dockerDashComposeVersion": "v2"
    },

    // Node Version Manager
    "ghcr.io/devcontainers/features/node:1": {
      "nodeGypDependencies": true,
      "version": "lts/*",
      "nvmVersion": "latest"
    },

    // Python para scripts auxiliares
    "ghcr.io/devcontainers/features/python:1": {
      "version": "3.11",
      "installTools": true
    },

    // Common utilities
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": true,
      "installOhMyZsh": true,
      "upgradePackages": true,
      "username": "vscode",
      "userUid": "1000",
      "userGid": "1000"
    },

    // Azure CLI (por si se usa Azure también)
    "ghcr.io/devcontainers/features/azure-cli:1": {
      "version": "latest"
    },

    // Terraform (IaC)
    "ghcr.io/devcontainers/features/terraform:1": {
      "version": "latest"
    },

    // SSHD para desarrollo remoto
    "ghcr.io/devcontainers/features/sshd:1": {
      "version": "latest"
    }
  },

  // Customizaciones de VSCode
  "customizations": {
    "vscode": {
      // Settings específicos del Codespace
      "settings": {
        // GitHub Copilot Enterprise
        "github.copilot.enable": {
          "*": true
        },
        "github.copilot.advanced": {
          "debug.overrideEngine": "gpt-4-turbo",
          "inlineSuggestCount": 5
        },

        // Terminal
        "terminal.integrated.defaultProfile.linux": "zsh",
        "terminal.integrated.profiles.linux": {
          "zsh": {
            "path": "/bin/zsh"
          },
          "bash": {
            "path": "/bin/bash"
          }
        },

        // Editor
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        "editor.codeActionsOnSave": {
          "source.fixAll.eslint": "explicit",
          "source.organizeImports": "explicit"
        },

        // Files
        "files.autoSave": "afterDelay",
        "files.autoSaveDelay": 1000,
        "files.trimTrailingWhitespace": true,
        "files.insertFinalNewline": true,

        // Git
        "git.enableSmartCommit": true,
        "git.autofetch": true,
        "git.confirmSync": false,
        "git.enableCommitSigning": true,

        // JavaScript/TypeScript
        "javascript.suggest.autoImports": true,
        "javascript.updateImportsOnFileMove.enabled": "always",
        "typescript.suggest.autoImports": true,
        "typescript.updateImportsOnFileMove.enabled": "always",
        "typescript.tsserver.maxTsServerMemory": 8192,

        // ESLint
        "eslint.validate": [
          "javascript",
          "javascriptreact",
          "typescript",
          "typescriptreact"
        ],
        "eslint.codeActionsOnSave.mode": "all",

        // Remote
        "remote.autoForwardPorts": true,
        "remote.autoForwardPortsSource": "hybrid",

        // Security
        "security.workspace.trust.enabled": false
      },

      // Extensiones a instalar automáticamente
      "extensions": [
        // GitHub & Copilot
        "GitHub.copilot",
        "GitHub.copilot-chat",
        "GitHub.vscode-pull-request-github",
        "eamodio.gitlens",

        // Desarrollo
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode",
        "bradlc.vscode-tailwindcss",
        "formulahendry.auto-rename-tag",
        "christian-kohler.path-intellisense",
        "zignd.html-css-class-completion",

        // Testing
        "ms-playwright.playwright",
        "hbenl.vscode-test-explorer",

        // Productividad
        "usernamehw.errorlens",
        "gruntfuggly.todo-tree",
        "streetsidesoftware.code-spell-checker",
        "wayou.vscode-todo-highlight",

        // UI/UX
        "PKief.material-icon-theme",
        "naumovs.color-highlight",
        "aaron-bond.better-comments",

        // Docker
        "ms-azuretools.vscode-docker",

        // Firebase
        "toba.vsfire",

        // JSON/YAML
        "redhat.vscode-yaml",
        "ZainChen.json",

        // REST Client
        "humao.rest-client",

        // Markdown
        "yzhang.markdown-all-in-one",
        "DavidAnson.vscode-markdownlint",

        // Live Share
        "ms-vsliveshare.vsliveshare",

        // Thunder Client (API testing)
        "rangav.vscode-thunder-client",

        // Import Cost
        "wix.vscode-import-cost",

        // Peacock (workspace colors)
        "johnpapa.vscode-peacock"
      ]
    },

    // Configuración de Codespaces
    "codespaces": {
      "openFiles": [
        "README.md",
        "src/main.jsx"
      ],
      "repositories": {
        "premium-ecosystem/*": {
          "permissions": {
            "contents": "write",
            "pull_requests": "write"
          }
        }
      }
    }
  },

  // Ports a reenviar automáticamente
  "forwardPorts": [
    5173,  // Vite dev server
    3000,  // Alternative dev server
    4173,  // Vite preview
    9000,  // Firebase emulator suite
    9099,  // Firebase auth emulator
    8080,  // Firebase hosting emulator
    9199,  // Firebase storage emulator
    4000,  // Firestore emulator
    4400,  // Firestore UI
    5001   // Firebase functions
  ],

  // Configuración de ports
  "portsAttributes": {
    "5173": {
      "label": "Vite Dev Server",
      "onAutoForward": "notify",
      "protocol": "http"
    },
    "3000": {
      "label": "Preview Server",
      "onAutoForward": "silent",
      "protocol": "http"
    },
    "4173": {
      "label": "Production Preview",
      "onAutoForward": "silent",
      "protocol": "http"
    },
    "9000": {
      "label": "Firebase Emulator Suite",
      "onAutoForward": "openBrowser",
      "protocol": "http"
    },
    "4000": {
      "label": "Firestore Emulator",
      "onAutoForward": "silent",
      "protocol": "http"
    }
  },

  // Lifecycle hooks
  "onCreateCommand": {
    "install-deps": "npm install",
    "setup-git": "git config --global --add safe.directory ${containerWorkspaceFolder}",
    "install-firebase": "npm install -g firebase-tools",
    "install-gh-extensions": "gh extension install github/gh-copilot || true"
  },

  "postCreateCommand": {
    "welcome": "echo '✅ Premium Ecosystem Codespace listo!'",
    "install": "npm ci",
    "prepare": "npm run prepare || true",
    "setup-hooks": "npx husky install || true"
  },

  "postStartCommand": {
    "info": "npm run dev --version",
    "firebase-login": "firebase login --no-localhost || echo 'Firebase CLI requiere autenticación manual'"
  },

  "postAttachCommand": {
    "logs": "echo 'Conectado al Codespace. Ejecuta: npm run dev'"
  },

  // Usuario en el contenedor
  "remoteUser": "vscode",
  "containerUser": "vscode",

  // Environment variables
  "remoteEnv": {
    "GITHUB_COPILOT_ENABLED": "true",
    "NODE_ENV": "development",
    "VITE_ENV": "development",
    "CODESPACES": "true",
    "FIREBASE_EMULATOR": "true",
    "CI": "false"
  },

  // Mounts para persistencia
  "mounts": [
    // SSH keys
    {
      "source": "${localEnv:HOME}${localEnv:USERPROFILE}/.ssh",
      "target": "/home/vscode/.ssh",
      "type": "bind",
      "consistency": "cached",
      "readonly": true
    },
    // Git config
    {
      "source": "${localEnv:HOME}${localEnv:USERPROFILE}/.gitconfig",
      "target": "/home/vscode/.gitconfig",
      "type": "bind",
      "consistency": "cached",
      "readonly": true
    },
    // NPM config
    {
      "source": "premium-ecosystem-node_modules",
      "target": "${containerWorkspaceFolder}/node_modules",
      "type": "volume"
    }
  ],

  // Configuración de recursos
  "hostRequirements": {
    "cpus": 4,
    "memory": "8gb",
    "storage": "32gb"
  },

  // Capabilities adicionales
  "capAdd": [
    "SYS_PTRACE"
  ],

  // Security options
  "securityOpt": [
    "seccomp=unconfined"
  ],

  // Init process
  "init": true,

  // Privileged mode (solo si es necesario)
  "privileged": false,

  // Override command
  "overrideCommand": false,

  // Update remote user UID/GID
  "updateRemoteUserUID": true,

  // Wait for
  "waitFor": "postCreateCommand",

  // Shutdown action
  "shutdownAction": "stopContainer"
}
